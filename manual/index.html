<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | Maps4News Api Wrapper</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<script src="./inject/script/0-bundle.js"></script><script src="./inject/script/0-sandbox.js"></script><link rel="stylesheet" href="./inject/css/0-sidebar_fix.css"><link rel="stylesheet" href="./inject/css/0-hide_import.css"><meta name="description" content="Maps4News Api Javascript Wrapper"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Maps4News Api Wrapper"><meta property="twitter:description" content="Maps4News Api Javascript Wrapper"></head>
<body class="layout-container manual-root manual-index" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/MapCreatorEU/api-wrapper"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/examples.html"><a href="manual/examples.html" data-ice="link">Basics</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#getting-a-resource" data-ice="link">Getting a resource</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#create-a-new-resource" data-ice="link">Create a new resource</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#modify-a-resource" data-ice="link">Modify a resource</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#clone-a-resource" data-ice="link">Clone a resource</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#pagination" data-ice="link">Pagination</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.html"><a href="manual/examples.html#searching" data-ice="link">Searching</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html" data-ice="link">Authentication</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#web" data-ice="link">Web</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#implicit-flow" data-ice="link">Implicit Flow</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#implicit-flow-pop-up" data-ice="link">Implicit flow pop-up</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#implicit-flow-pop-up--advanced-" data-ice="link">Implicit flow pop-up (advanced)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#password-flow--dangerous-" data-ice="link">Password flow (dangerous)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#dummy-flow" data-ice="link">Dummy flow</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#nodejs" data-ice="link">Nodejs</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#password-flow" data-ice="link">Password Flow</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/examples.authentication.html"><a href="manual/examples.authentication.html#dummy-flow" data-ice="link">Dummy flow</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/building.html"><a href="manual/building.html" data-ice="link">Building</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/building.html"><a href="manual/building.html#building-docs" data-ice="link">Building docs</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/installation.html"><a href="manual/installation.html" data-ice="link">Installation</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-user-index" data-ice="manualUserIndex"><h2 id="maps4news-javascript-api--a-href--https---www-npmjs-com-package--mapcreator-maps4news---img-src--https---img-shields-io-npm-v--mapcreator-maps4news-svg--alt--npm-version----a-">Maps4News Javascript API <a href="https://www.npmjs.com/package/@mapcreator/maps4news"><img src="https://img.shields.io/npm/v/@mapcreator/maps4news.svg" alt="npm version"></a></h2><p>The Maps4News API is a powerful mapping service built for our front-end applications. This library is released to 
provide a painless way of talking to the api using Javascript. See the <a href="https://github.com/MapCreatorEU/api-wrapper/blob/master/LICENSE">LICENSE</a> file for licensing information. Api 
tokens can be granted through support requests.</p>
<h2 id="documentation">Documentation</h2><p>The documentation can be found <a href="https://mapcreatoreu.github.io/api-wrapper/">here</a>. Please refer to the <a href="https://api.beta.maps4news.com/docs/">api documentation</a> for resource information. Job structure documentation will be released soon. </p>
<h2 id="installation">Installation</h2><p>Please refer to the installation docs <a href="https://mapcreatoreu.github.io/api-wrapper/manual/installation/installation.html">here</a>.</p>
<h2 id="download">Download</h2><p>The library is built to be ran in either the browser or using nodejs. </p>
<ul>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/dist/bundle.js">download library</a></li>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/dist/bundle.min.js">minified</a></li>
</ul>
<p>The source code can be found on the <a href="https://github.com/MapCreatorEU/api-wrapper">GitHub repo</a>. The <code>master</code> branch is used minor versions and the <code>develop</code> branch is patches. </p>
<h2 id="building">Building</h2><p>Please refer to the build docs <a href="https://mapcreatoreu.github.io/api-wrapper/manual/installation/building.html">here</a></p>
<h2 id="authenticating">Authenticating</h2><p>Authentication can be done using OAuth. Examples of how to use authentication can be found <a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html">in the documentation</a>. The 
following authentication methods are supported: </p>
<ul>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html#implicit-flow">ImplicitFlow</a></li>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html#implicit-flow-pop-up">ImplicitPopupFlow</a></li>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html#password-flow">PasswordFlow</a> (<a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html#password-flow-dangerous-">web</a>)</li>
<li><a href="https://mapcreatoreu.github.io/api-wrapper/manual/example/examples.authentication.html#dummy-flow">DummyFlow</a></li>
</ul>
<h2 id="examples">Examples</h2><p>Examples can be found in the documentation under the &quot;<a href="https://mapcreatoreu.github.io/api-wrapper/manual/index.html">Manual</a>&quot; section.</p>
<h2 id="license">License</h2><p>See the <a href="https://github.com/MapCreatorEU/api-wrapper/blob/master/LICENSE">LICENSE</a> file for license information. This project is licensed under a <a href="https://tldrlegal.com/license/bsd-3-clause-license-(revised)">BSD-3-Clause</a> license.</p>
</div>

  

  <div class="manual-cards">
    
  <div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Basics</h1><p>These examples assume that an instance of the api exists and is authenticated. 
See the node and web authentication examples for more information on authenticating.</p><h3>Getting a resource</h3><p>Resources are bound to the base api class by default. Resources can be fetched in 
two ways; by selecting them (<code>.select</code>) or by fetching them (<code>.get</code>). Selecting them will only set the
object&apos;s id to it&apos;s properties. Fetching a resource</p><p>Fetch resource and all it&apos;s properties:</p><pre><code class="lang-js"><code class="source-code prettyprint">api.colors.get(1).then(function(color) {
    console.log(color.id + &quot; &quot; + color.name + &quot;: &quot; + color.hex);
})</code>
</code></pre><p>Select the current user to quickly obtain related mapstyle sets:</p><pre><code class="lang-js"><code class="source-code prettyprint">api.users.select(&apos;me&apos;).mapstyleSets().then(function(sets) {
    for(var i = 0; i &lt; sets.data.length; i++) {
        console.log(sets.data[i].name);
    }
});</code>
</code></pre><p>Selection is only usefull as a stepping stone to related resources that can be easily obtained 
using the id of the parent. Please refer to the [api documentation] for further reference.</p><h3>Create a new resource</h3><p>Create a new color and dump the new resource to the console after saving</p><pre><code class="lang-js"><code class="source-code prettyprint">var data = {name: &apos;Smurf&apos;, hex: &apos;88CCFF&apos;};
api.colors.new(data).save().then(console.dir);</code>
</code></pre><h3>Modify a resource</h3><p>Change profession of the current user and save it.</p><pre><code class="lang-js"><code class="source-code prettyprint">api.users.get(&apos;me&apos;).then(me =&gt; {
  me.profession = &apos;Developer&apos;;
  me.save(); // Optional chaining to get the updated resource
});</code>
</code></pre><h3>Clone a resource</h3><p>Setting the id to null forces the creation of a new object upon saving. </p><pre><code class="lang-js"><code class="source-code prettyprint">api.colors.get(1).then(color =&gt; {
  color.id = null;
  color.save();
});</code>
</code></pre><h3>Pagination</h3><p>Listing resources with pagination. First page with 5 items per page</p><pre><code class="lang-js"><code class="source-code prettyprint">api.colors.list(1, 5).then(page =&gt; {
  console.log(&apos;Got resources:&apos;);

  for (var i = 0; i &lt; page.data.length; i++) {
    console.log(page.data[i].toString());
  }
});</code>
</code></pre><p>Loop over every page and print the result to the console.</p><pre><code class="lang-js"><code class="source-code prettyprint">function parsePages(page) {
  for (var i = 0; i &lt; page.data.length; i++) {
    console.log(page.data[i].toString());     
  }  

  if (page.hasNext) {
    console.log(&apos;Grabbing page &apos; + (page.page + 1));
    page.next().then(parsePage);
  }
}

api.colors
   .list(1, 50)
   .then(parsePages);</code>
</code></pre><p>Loop over all pages and return the data in a promise</p><pre><code class="lang-js"><code class="source-code prettyprint">function parsePages(page) {
  var data = [];

  function parse(page) {
      data = data.concat(page.data);

      if(page.hasNext) {
          return page.next().then(parse);
      } else {
          return data;
      }
  }  

  return parse(page);
}

api.colors
   .list(1, 50)
   .then(parsePages)
   .then(d =&gt; console.log(&apos;Total rows: &apos; + d.length));</code>
</code></pre><p>Select current user but do not fetch any info to make fetching resources easier.</p><pre><code class="lang-js"><code class="source-code prettyprint">api.users.select(&apos;me&apos;).colors.list().then(page =&gt; {
  console.dir(page.data);
});</code>
</code></pre><h3>Searching</h3><p>Resource lists can be queried to search for specific records as follows:</p><pre><code class="lang-js"><code class="source-code prettyprint">var query = {
  name: &apos;^:test&apos;,
  scale_min: [&apos;&gt;:1&apos;, &apos;&lt;:10&apos;],
}
api.layers.search(query).then(console.dir);</code>
</code></pre><p>The <code>search</code> method is an extension of <code>list</code>. This means that <code>.search({})</code> is the same as 
<code>list()</code>. More information about search query formatting can be found in the [api documentation].</p></div>
        <a data-ice="link" href="manual/examples.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Authentication</h1><p>Authentication is done through <a href="https://oauth.org">OAuth</a>. This library provides multiple <a href="https://aaronparecki.com/oauth-2-simplified/#authorization">OAuth flow</a>
implementations for authentication. A client id can be obtained through a support
ticket but this is planned to change in the near future. The client will first
check if any tokens can be found in the cache before requiring authentication.
If one can be found the <code>api.authenticate()</code> method will instantly resolve without 
any side-effects. The variable <code>api.authenticated</code> will be set to true if a token
has been found and is still valid. </p><p>Tokens are stored in HTTPS cookies if possible and using <code>localStorage</code> when the
browser is not using a HTTPS connection. <a href="https://nodejs.org">Nodejs</a> uses a file named <code>.m4n_token</code> to store the token.</p><h2>Web</h2><p>Multiple flows are supported for web browsers. All the web examples assume the web
build of the library has been included in the target page.</p><h3>Implicit Flow</h3><p>A client id is required to use the implicit flow. The redirect url <em>must</em> be the 
same as the one linked to the client id. The callback url is automatically 
guessed if none is provided.</p><pre><code class="lang-js"><code class="source-code prettyprint">// Obtained client id
var clientId = 1;

// Callback url is set to the current url by default
var auth = new ImplicitFlow(clientId);
var api = new Maps4News(auth);

// This will hijack the page if no authentication cache can
// be found. Smartest thing to do is to just let it happen
// and initialize any other code afterwards.
api.authenticate().then(function() {
  // Save the token
  api.saveToken();

  // Get the current user and dump the result to the console.
  api.users.get(&apos;me&apos;).then(console.dir);
});</code>
</code></pre><h3>Implicit flow pop-up</h3><p>Just like the Implicit Flow a client id is required. </p><pre><code class="lang-js"><code class="source-code prettyprint">// Obtained client id
var clientId = 1;

// Callback url is set to the current url by default. The
// script is smart enough close the page if it detects that
// it&apos;s a child after authentication. This means that either
// the current page can be set as the callback (default) or
// a custom page that just contains `api.authenticate()`
// that uses ImplicitFlowPopup as the auth parameter.
var auth = new ImplicitFlowPopup(clientId);
var api = new Maps4News(auth);

// This will create a pop-up window containing the log in
// page. Once the pop-up redirects back to the callback it
// will resolve the promise. The callback page should contain
api.authenticate().then(function() {
  // Save the token
  api.saveToken();

  // Get the current user and dump the result to the console.
  api.users.get(&apos;me&apos;).then(console.dir);
});</code>
</code></pre><h3>Implicit flow pop-up (advanced)</h3><p>Due to the nature of the implicit flow pop-up (referred to as IFP from now on)
method the callback page can be set to a blank page that just grabs the token 
and then closes. This can be done in the following way.</p><p><strong>index.html:</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">var clientId = 1;
var callbackUrl = &apos;https://example.com/callback.html&apos;;

var auth = new ImplicitFlowPopup(clientId);
var api = new Maps4News(auth);

// This will resolve once the callback page has been loaded
api.authenticate().then(function() {
  // Save the token
  api.saveToken();

  // Get the current user and dump the result to the console.
  api.users.get(&apos;me&apos;).then(console.dir);
});</code>
</code></pre><p><strong>callback.html:</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">var clientId = 1;

// This will instantly detect the token and close the page
new ImplicitFlowPopup(clientId);</code>
</code></pre><h3>Password flow (dangerous)</h3><p>The password flow is <strong>NOT</strong> intended to be used in the browser. If you do 
decide to use the password flow then it is recommended to make sure that 
the site is <strong>NOT</strong> public facing and using HTTPS. Leaking the <a href="https://www.youtube.com/watch?v=zwZISypgA9M">secret</a> is
a very bad idea.</p><pre><code class="lang-js"><code class="source-code prettyprint">var clientId = 1; // client id
var secret = &apos;&apos;; // secret
var username = &apos;user@example.com&apos;; // email is used for authentication
var password = &apos;Password1!&apos;; // password

// Secret will be leaked if this is used on a webpage. Please only use
// this for non-web applications.
var auth = new PasswordFlow(clientId, secret, username, password);
var api = new Maps4News(auth);

// This will resolve once the authentication has completed
api.authenticate().then(function() {
  // Get the current user and dump the result to the console.
  api.users.get(&apos;me&apos;).then(console.dir);
});</code>
</code></pre><h3>Dummy flow</h3><p>The dummy flow can be used when a token <em>should</em> be present in the cache. </p><pre><code class="lang-js"><code class="source-code prettyprint">var auth = new DummyFlow();
var api = new Maps4News(auth);

// Manually check if we&apos;re logged in
if (api.authenticated) {
    console.log(&apos;Found authentication token in cache!&apos;);
}

api.authenticate().then(function() {
    // Will only resolve if a token was found
    console.log(&quot;We&apos;re authenticated&quot;);
}).catch(function(err) {
    // This will be called if `api.authenticated` is false
    console.log(err.toString());
});</code>
</code></pre><h2>Nodejs</h2><p>The library currently only supports the password flow and the dummy flow
for <a href="https://nodejs.org">nodejs</a>. Other flows might be added in the future.</p><h3>Password Flow</h3><p>Make sure to store your <a href="https://www.youtube.com/watch?v=zwZISypgA9M">secret</a> somewhere safe and to only store the token
and <strong>never</strong> the unencrypted user password.</p><pre><code class="lang-js"><code class="source-code prettyprint">var clientId = 1; // client id
var secret = &apos;&apos;; // secret
var username = &apos;user@example.com&apos;; // email is used for authentication
var password = &apos;Password1!&apos;; // password

var auth = new PasswordFlow(clientId, secret, username, password);
var api = new Maps4News(auth);

// This will resolve once the authentication has completed
api.authenticate().then(function() {
  // Get the current user and dump the result to the console.
  api.users.get(&apos;me&apos;).then(console.dir);
});</code>
</code></pre><h3>Dummy flow</h3><p>The dummy flow can also be used when a token is known.</p><pre><code class="lang-js"><code class="source-code prettyprint">var auth = new DummyFlow();
var api = new Maps4News(auth);

var token = {
  token: &quot;eyJ0eXAiOiJKV1...&quot;,
  type: &quot;Bearer&quot;,
  expires: &quot;Thu, 18 May 2017 14:14:38 GMT&quot;
};

// Set the token
api.auth.token = OAuthToken.fromResponseObject(token);

// Manually check if we&apos;re logged in
if (api.authenticated) {
    console.log(&apos;Found authentication token in cache!&apos;);
}

api.authenticate().then(function() {
    // Will only resolve if a token was found
    console.log(&quot;We&apos;re authenticated&quot;);
}).catch(function(err) {
    // This will be called if `api.authenticated` is false
    console.log(err.toString());
});</code>
</code></pre></div>
        <a data-ice="link" href="manual/examples.authentication.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Building</h1><p>Building the api can be done using [yarn] and [webpack]. The result will be placed in the <code>/dist</code> folder. Both the web 
and nodejs releases are built this way.</p><pre><code class="lang-sh"><code class="source-code prettyprint">yarn install
yarn run build</code>
</code></pre><h2>Building docs</h2><p>The docs can be built using [esdoc] after which they can be found in the <code>/docs</code> folder.</p><pre><code class="lang-sh"><code class="source-code prettyprint">yarn install
yarn run docs</code>
</code></pre><p>Development docs can be built by adding <code>&quot;private&quot;</code> to the <code>esdoc.access</code> variable in <code>package.json</code> before building the
docs. </p></div>
        <a data-ice="link" href="manual/building.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Installation</h1><p>Installation can be done through either <a href="https://npmjs.com">npm</a> or <a href="https://yarnpkg.com">yarn</a>.</p><pre><code class="lang-sh"><code class="source-code prettyprint">// Using npm
npm install --save @mapcreator/maps4news

// Using yarn
yarn add @mapcreator/maps4news</code>
</code></pre><p>After installation the package can be imported as follows:</p><pre><code class="lang-js"><code class="source-code prettyprint">var m4n = require(&apos;@mapcreator/maps4news&apos;);

// Do stuff
var auth = new m4n.ImplicitFlow(1);
var api = new m4n.Maps4News(auth);</code>
</code></pre><p>or using ES6 import statements:</p><pre><code class="lang-js"><code class="source-code prettyprint">import {Maps4News, DummyFlow} from &apos;@mapcreator/maps4news&apos;;

// Do stuff
var auth = new DummyFlow();
var api = new Maps4News(auth);</code>
</code></pre></div>
        <a data-ice="link" href="manual/installation.html"></a>
      </div>
    </div>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
